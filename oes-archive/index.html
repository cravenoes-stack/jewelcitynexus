<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JewelCityNexus File Processor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #2ecc71;
            --warning: #f39c12;
            --gray: #95a5a6;
            --light-gray: #f5f5f5;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            line-height: 1.6;
        }
        
        .container {
            width: 100%;
            max-width: 1400px;
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            transform: rotate(30deg);
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            font-weight: 700;
            position: relative;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            font-weight: 300;
            max-width: 600px;
            margin: 0 auto;
            position: relative;
        }
        
        .logo {
            font-size: 2.5rem;
            margin-bottom: 15px;
            display: inline-block;
            background: linear-gradient(135deg, #fff 0%, #3498db 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 2px 5px rgba(0,0,0,0.3));
        }
        
        .main-content {
            padding: 40px;
            display: flex;
            flex-direction: column;
            gap: 40px;
        }
        
        .upload-section {
            background-color: var(--light-gray);
            padding: 30px;
            border-radius: 12px;
            border: 2px dashed var(--secondary);
            text-align: center;
            transition: var(--transition);
        }
        
        .upload-section:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
            box-shadow: var(--shadow);
        }
        
        .upload-btn {
            background: linear-gradient(90deg, var(--secondary) 0%, var(--primary) 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: var(--transition);
            margin-top: 20px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        .upload-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.4);
        }
        
        .analysis-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow);
        }
        
        .analysis-section h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light-gray);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .analysis-section h2::before {
            content: '\f201';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            color: var(--secondary);
        }
        
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .analysis-card {
            background: var(--light-gray);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid var(--secondary);
        }
        
        .analysis-card h3 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .analysis-content {
            color: var(--dark);
            line-height: 1.6;
        }
        
        .category-section {
            margin-bottom: 40px;
        }
        
        .category-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light-gray);
        }
        
        .category-header h2 {
            color: var(--primary);
            font-size: 1.8rem;
        }
        
        .category-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--secondary) 0%, var(--primary) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }
        
        .files-section h2 {
            color: var(--primary);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light-gray);
            font-size: 2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .files-section h2::before {
            content: '\f07c';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            color: var(--secondary);
        }
        
        .file-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 30px;
        }
        
        .file-card {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 25px;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            border: 1px solid var(--light-gray);
            position: relative;
            overflow: hidden;
        }
        
        .file-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(135deg, var(--secondary) 0%, var(--primary) 100%);
        }
        
        .file-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }
        
        .file-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .file-icon {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, var(--secondary) 0%, var(--primary) 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        .file-icon i {
            color: white;
            font-size: 24px;
        }
        
        .file-info {
            flex-grow: 1;
        }
        
        .file-name {
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
            font-size: 1.3rem;
        }
        
        .file-meta {
            font-size: 0.95rem;
            color: var(--gray);
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .file-actions {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        .btn {
            flex: 1;
            padding: 12px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: var(--transition);
            font-weight: 600;
        }
        
        .btn-download {
            background: linear-gradient(90deg, var(--success) 0%, #27ae60 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
        }
        
        .btn-download:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(46, 204, 113, 0.4);
        }
        
        .btn-preview {
            background: linear-gradient(90deg, var(--secondary) 0%, #2980b9 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }
        
        .btn-preview:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.4);
        }
        
        .preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background-color: white;
            width: 90%;
            max-width: 1100px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            max-height: 90vh;
        }
        
        .modal-header {
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            transition: var(--transition);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }
        
        .modal-body {
            padding: 30px;
            overflow-y: auto;
            flex-grow: 1;
        }
        
        .file-content {
            line-height: 1.7;
            color: #333;
            font-size: 1.1rem;
        }
        
        .file-content p {
            margin-bottom: 20px;
            padding: 15px;
            background: var(--light-gray);
            border-radius: 8px;
            border-left: 4px solid var(--secondary);
        }
        
        .participant {
            font-weight: 700;
            color: var(--primary);
            display: block;
            margin-bottom: 5px;
        }
        
        .modal-footer {
            padding: 20px 30px;
            background-color: var(--light-gray);
            display: flex;
            justify-content: flex-end;
            border-top: 1px solid var(--light-gray);
        }
        
        .no-files {
            grid-column: 1 / -1;
            text-align: center;
            padding: 60px;
            color: var(--gray);
            font-size: 1.2rem;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-ready {
            background-color: var(--success);
        }
        
        .status-processing {
            background-color: var(--warning);
        }
        
        .file-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            background: var(--light);
            color: var(--dark);
        }
        
        @media (max-width: 992px) {
            .file-list, .analysis-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .main-content {
                padding: 25px;
            }
            
            .file-list, .analysis-grid {
                grid-template-columns: 1fr;
            }
            
            .file-actions {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .modal-content {
                width: 95%;
            }
        }
        
        /* Animation for file cards */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .file-card {
            animation: fadeIn 0.5s ease forwards;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--secondary);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-gem"></i>
            </div>
            <h1>JewelCityNexus File Processor</h1>
            <p class="subtitle">Professional file processing with conversation analysis and categorization</p>
        </header>
        
        <div class="main-content">
            <div class="upload-section">
                <h2><i class="fas fa-cloud-upload-alt"></i> Upload Files for Processing</h2>
                <p>Supported formats: .txt, .json, .csv, .log, .md</p>
                <input type="file" id="file-upload" multiple style="display: none;">
                <button class="upload-btn" onclick="document.getElementById('file-upload').click()">
                    <i class="fas fa-file-upload"></i> Select Files
                </button>
            </div>
            
            <div class="analysis-section">
                <h2>Conversation Analysis</h2>
                <div class="analysis-grid">
                    <div class="analysis-card">
                        <h3><i class="fas fa-comments"></i> Conversation Summary</h3>
                        <div class="analysis-content" id="conversation-summary">
                            Upload files to see conversation analysis...
                        </div>
                    </div>
                    <div class="analysis-card">
                        <h3><i class="fas fa-users"></i> Participant Analysis</h3>
                        <div class="analysis-content" id="participant-analysis">
                            Participant data will appear here...
                        </div>
                    </div>
                    <div class="analysis-card">
                        <h3><i class="fas fa-chart-line"></i> Sentiment Analysis</h3>
                        <div class="analysis-content" id="sentiment-analysis">
                            Sentiment metrics will be displayed here...
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="files-section">
                <h2>Processed Files</h2>
                
                <!-- Original categories from the reference site -->
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-icon">
                            <i class="fas fa-couch"></i>
                        </div>
                        <h2>Loveseat Upholstery Design Advice</h2>
                    </div>
                    <div class="file-list" id="design-files">
                        <div class="no-files" id="no-design-files">
                            <p><i class="fas fa-couch" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;"></i></p>
                            <p>No design files processed yet.</p>
                        </div>
                    </div>
                </div>
                
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-icon">
                            <i class="fas fa-ruler-combined"></i>
                        </div>
                        <h2>Measurement Guides</h2>
                    </div>
                    <div class="file-list" id="measurement-files">
                        <div class="no-files" id="no-measurement-files">
                            <p><i class="fas fa-ruler-combined" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;"></i></p>
                            <p>No measurement files processed yet.</p>
                        </div>
                    </div>
                </div>
                
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-icon">
                            <i class="fas fa-tools"></i>
                        </div>
                        <h2>Technical Specifications</h2>
                    </div>
                    <div class="file-list" id="technical-files">
                        <div class="no-files" id="no-technical-files">
                            <p><i class="fas fa-tools" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;"></i></p>
                            <p>No technical files processed yet.</p>
                        </div>
                    </div>
                </div>
                
                <div class="category-section">
                    <div class="category-header">
                        <div class="category-icon">
                            <i class="fas fa-star"></i>
                        </div>
                        <h2>Customer Feedback & Reviews</h2>
                    </div>
                    <div class="file-list" id="feedback-files">
                        <div class="no-files" id="no-feedback-files">
                            <p><i class="fas fa-star" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;"></i></p>
                            <p>No feedback files processed yet.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="preview-modal" id="preview-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">File Preview</h3>
                <button class="close-btn" onclick="closePreview()">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <div class="file-content" id="file-content">
                    <!-- File content will be displayed here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-download" onclick="downloadCurrentFile()">
                    <i class="fas fa-download"></i> Download as HTML
                </button>
            </div>
        </div>
    </div>

    <script>
        // File processor functionality
        const fileProcessor = {
            processedFiles: [],
            
            processFile: function(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    
                    reader.onload = (e) => {
                        // Simulate processing time
                        setTimeout(() => {
                            const content = e.target.result;
                            const category = this.determineCategory(file.name, content);
                            const processedFile = {
                                id: Date.now() + Math.floor(Math.random() * 1000),
                                name: file.name,
                                type: this.getFileType(file.name),
                                date: new Date().toLocaleDateString(),
                                size: this.formatFileSize(file.size),
                                content: content,
                                status: 'ready',
                                category: category
                            };
                            
                            this.processedFiles.push(processedFile);
                            resolve(processedFile);
                        }, 1500);
                    };
                    
                    reader.onerror = (error) => reject(error);
                    reader.readAsText(file);
                });
            },
            
            getFileType: function(filename) {
                const ext = filename.split('.').pop().toLowerCase();
                if (['txt', 'log', 'md'].includes(ext)) return 'text';
                if (['json'].includes(ext)) return 'JSON';
                if (['csv'].includes(ext)) return 'CSV';
                return 'document';
            },
            
            determineCategory: function(filename, content) {
                const lowerContent = content.toLowerCase();
                
                // Using the original categories from the reference site
                if (lowerContent.includes('upholstery') || lowerContent.includes('design') || 
                    lowerContent.includes('fabric') || lowerContent.includes('color') ||
                    lowerContent.includes('loveseat')) {
                    return 'design';
                } else if (lowerContent.includes('measure') || lowerContent.includes('dimension') || 
                          lowerContent.includes('size') || lowerContent.includes('guide')) {
                    return 'measurement';
                } else if (lowerContent.includes('technical') || lowerContent.includes('spec') || 
                          lowerContent.includes('material') || lowerContent.includes('frame')) {
                    return 'technical';
                } else if (lowerContent.includes('feedback') || lowerContent.includes('review') || 
                          lowerContent.includes('customer') || lowerContent.includes('client')) {
                    return 'feedback';
                }
                
                return 'design'; // Default category
            },
            
            formatFileSize: function(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            },
            
            generateHTML: function(file) {
                let htmlContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${file.name}</title>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <style>
                        body {
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                            line-height: 1.7;
                            margin: 0;
                            padding: 40px;
                            color: #333;
                            max-width: 1000px;
                            margin-left: auto;
                            margin-right: auto;
                            background: #f9f9f9;
                        }
                        .header {
                            border-bottom: 3px solid #3498db;
                            padding-bottom: 20px;
                            margin-bottom: 30px;
                        }
                        h1 {
                            color: #2c3e50;
                            margin-bottom: 10px;
                        }
                        .meta {
                            color: #7f8c8d;
                            font-size: 1rem;
                            margin-bottom: 25px;
                            display: flex;
                            flex-wrap: wrap;
                            gap: 20px;
                        }
                        .meta span {
                            display: flex;
                            align-items: center;
                            gap: 5px;
                        }
                        .content {
                            background: white;
                            padding: 30px;
                            border-radius: 12px;
                            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
                            border-left: 5px solid #3498db;
                        }
                        .conversation p {
                            margin: 15px 0;
                            padding: 15px;
                            background: #f8f9fa;
                            border-radius: 8px;
                            border-left: 4px solid #e74c3c;
                        }
                        .participant {
                            font-weight: 700;
                            color: #2c3e50;
                            display: block;
                            margin-bottom: 8px;
                            font-size: 1.1rem;
                        }
                        pre {
                            white-space: pre-wrap;
                            font-family: 'Courier New', monospace;
                            background: #2c3e50;
                            color: #ecf0f1;
                            padding: 20px;
                            border-radius: 8px;
                            overflow-x: auto;
                        }
                        .footer {
                            margin-top: 40px;
                            text-align: center;
                            color: #7f8c8d;
                            font-size: 0.9rem;
                            border-top: 1px solid #eee;
                            padding-top: 20px;
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>${file.name}</h1>
                        <div class="meta">
                            <span><i class="fas fa-file"></i> <strong>Type:</strong> ${file.type}</span>
                            <span><i class="fas fa-calendar"></i> <strong>Processed on:</strong> ${file.date}</span>
                            <span><i class="fas fa-weight"></i> <strong>Size:</strong> ${file.size}</span>
                            <span><i class="fas fa-tag"></i> <strong>Category:</strong> ${file.category}</span>
                        </div>
                    </div>
                    <div class="content">
                `;
                
                if (file.type === 'text' || file.type === 'JSON' || file.type === 'CSV') {
                    htmlContent += `<pre>${file.content}</pre>`;
                } else {
                    // Format conversation content
                    const lines = file.content.split('\n');
                    for (const line of lines) {
                        if (line.includes(':') && line.length < 200) {
                            const parts = line.split(':');
                            const participant = parts[0];
                            const message = parts.slice(1).join(':');
                            htmlContent += `<p><span class="participant">${participant}:</span> ${message}</p>`;
                        } else {
                            htmlContent += `<p>${line}</p>`;
                        }
                    }
                }
                
                htmlContent += `
                    </div>
                    <div class="footer">
                        <p>Processed by JewelCityNexus File Processor</p>
                    </div>
                </body>
                </html>
                `;
                
                return htmlContent;
            },
            
            analyzeConversation: function(content) {
                // Simple analysis logic
                const lines = content.split('\n');
                let participants = new Set();
                let questions = 0;
                let statements = 0;
                
                for (const line of lines) {
                    if (line.includes(':')) {
                        const participant = line.split(':')[0].trim();
                        participants.add(participant);
                        
                        if (line.includes('?')) questions++;
                        else statements++;
                    }
                }
                
                return {
                    participantCount: participants.size,
                    participants: Array.from(participants),
                    lineCount: lines.length,
                    questions: questions,
                    statements: statements
                };
            }
        };

        // UI functionality
        const app = {
            init: function() {
                this.bindEvents();
            },
            
            bindEvents: function() {
                document.getElementById('file-upload').addEventListener('change', (e) => {
                    this.handleFileUpload(e.target.files);
                });
            },
            
            handleFileUpload: function(files) {
                if (files.length === 0) return;
                
                for (let i = 0; i < files.length; i++) {
                    this.addPlaceholderCard(files[i]);
                    
                    fileProcessor.processFile(files[i])
                        .then(processedFile => {
                            this.updateFileCard(processedFile);
                            this.updateAnalysis(processedFile);
                        })
                        .catch(error => {
                            console.error('Error processing file:', error);
                        });
                }
            },
            
            addPlaceholderCard: function(file) {
                const category = fileProcessor.determineCategory(file.name, "");
                const fileList = document.getElementById(`${category}-files`);
                const noFiles = document.getElementById(`no-${category}-files`);
                
                if (noFiles.style.display !== 'none') {
                    noFiles.style.display = 'none';
                }
                
                const fileCard = document.createElement('div');
                fileCard.className = 'file-card';
                fileCard.id = 'card-' + file.name;
                
                fileCard.innerHTML = `
                    <div class="file-header">
                        <div class="file-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="file-info">
                            <div class="file-name">${file.name}</div>
                            <div class="file-meta">
                                <span class="status-indicator status-processing"></span>
                                Processing...
                            </div>
                        </div>
                    </div>
                    <div class="file-actions">
                        <button class="btn btn-download" disabled>
                            <i class="fas fa-download"></i> Download
                        </button>
                        <button class="btn btn-preview" disabled>
                            <i class="fas fa-eye"></i> Preview
                        </button>
                    </div>
                `;
                
                fileList.appendChild(fileCard);
            },
            
            updateFileCard: function(file) {
                const fileCard = document.createElement('div');
                fileCard.className = 'file-card';
                
                fileCard.innerHTML = `
                    <div class="file-header">
                        <div class="file-icon">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="file-info">
                            <div class="file-name">${file.name}</div>
                            <div class="file-meta">
                                <span class="status-indicator status-ready"></span>
                                ${file.type} · ${file.date} · ${file.size}
                                <span class="file-badge">${file.category}</span>
                            </div>
                        </div>
                    </div>
                    <div class="file-actions">
                        <button class="btn btn-download" onclick="downloadFile(${file.id})">
                            <i class="fas fa-download"></i> Download
                        </button>
                        <button class="btn btn-preview" onclick="previewFile(${file.id})">
                            <i class="fas fa-eye"></i> Preview
                        </button>
                    </div>
                `;
                
                const oldCard = document.getElementById('card-' + file.name);
                if (oldCard) {
                    oldCard.parentNode.replaceChild(fileCard, oldCard);
                } else {
                    document.getElementById(`${file.category}-files`).appendChild(fileCard);
                }
            },
            
            updateAnalysis: function(file) {
                const analysis = fileProcessor.analyzeConversation(file.content);
                
                // Update conversation summary
                document.getElementById('conversation-summary').innerHTML = `
                    <p><strong>${file.name}</strong> contains ${analysis.lineCount} lines with ${analysis.questions} questions and ${analysis.statements} statements.</p>
                    <p>This conversation is categorized as <strong>${file.category}</strong>.</p>
                `;
                
                // Update participant analysis
                document.getElementById('participant-analysis').innerHTML = `
                    <p><strong>${analysis.participantCount} participants</strong> detected in this conversation:</p>
                    <ul>
                        ${analysis.participants.map(p => `<li>${p}</li>`).join('')}
                    </ul>
                `;
                
                // Update sentiment analysis
                const sentimentScore = Math.round((analysis.questions / analysis.lineCount) * 100);
                document.getElementById('sentiment-analysis').innerHTML = `
                    <p>Conversation appears to be <strong>${sentimentScore > 30 ? 'inquisitive' : 'declarative'}</strong> in nature.</p>
                    <p>Question to statement ratio: <strong>${analysis.questions}:${analysis.statements}</strong></p>
                `;
            },
            
            renderFilePreview: function(file) {
                const modalTitle = document.getElementById('modal-title');
                const fileContent = document.getElementById('file-content');
                
                modalTitle.textContent = `Preview: ${file.name}`;
                
                if (file.type === 'text' || file.type === 'JSON' || file.type === 'CSV') {
                    fileContent.innerHTML = `<pre>${file.content}</pre>`;
                } else {
                    // Format conversation content for preview
                    const lines = file.content.split('\n');
                    let formattedContent = '';
                    
                    for (const line of lines) {
                        if (line.includes(':') && line.length < 200) {
                            const parts = line.split(':');
                            const participant = parts[0];
                            const message = parts.slice(1).join(':');
                            formattedContent += `<p><span class="participant">${participant}:</span> ${message}</p>`;
                        } else {
                            formattedContent += `<p>${line}</p>`;
                        }
                    }
                    
                    fileContent.innerHTML = formattedContent;
                }
                
                document.getElementById('preview-modal').style.display = 'flex';
            }
        };

        // Global functions for button actions
        let currentFileId = null;

        function downloadFile(fileId) {
            const file = fileProcessor.processedFiles.find(f => f.id === fileId);
            if (!file) return;
            
            const htmlContent = fileProcessor.generateHTML(file);
            
            // Create download link
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${file.name.replace(/\s+/g, '_')}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function previewFile(fileId) {
            const file = fileProcessor.processedFiles.find(f => f.id === fileId);
            if (!file) return;
            
            currentFileId = fileId;
            app.renderFilePreview(file);
        }

        function closePreview() {
            document.getElementById('preview-modal').style.display = 'none';
            currentFileId = null;
        }

        function downloadCurrentFile() {
            if (currentFileId) {
                downloadFile(currentFileId);
                closePreview();
            }
        }

        // Close modal if clicked outside content
        window.onclick = function(event) {
            const modal = document.getElementById('preview-modal');
            if (event.target === modal) {
                closePreview();
            }
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            app.init();
            
            // Add some sample files for demonstration
            setTimeout(() => {
                const sampleFiles = [
                    {
                        name: 'Loveseat Upholstery Design Discussion.txt',
                        type: 'text',
                        content: `Designer: I think we should go with a velvet upholstery for the loveseat.\nClient: Would that be durable enough for everyday use?\nDesigner: Yes, modern velvet is quite durable and has excellent texture.\nClient: What color options do you recommend?\nDesigner: I suggest emerald green or navy blue - both are trending now.\nClient: I like the emerald green idea. Let's proceed with that.`,
                        category: 'design'
                    },
                    {
                        name: 'Measurement Guide.txt',
                        type: 'text',
                        content: `Expert: For a standard loveseat, the width should be between 48-72 inches.\nClient: What about the depth?\nExpert: Typically 35-40 inches for comfortable seating.\nClient: And the height?\nExpert: Standard seat height is 18-20 inches, with total height around 36 inches.`,
                        category: 'measurement'
                    },
                    {
                        name: 'Technical Specifications.json',
                        type: 'JSON',
                        content: JSON.stringify({
                            product: "Loveseat",
                            dimensions: {
                                width: "60 inches",
                                depth: "35 inches",
                                height: "36 inches"
                            },
                            materials: {
                                frame: "Hardwood",
                                upholstery: "Velvet",
                                filling: "High-density foam"
                            },
                            features: ["Reclining mechanism", "Storage compartment", "Adjustable headrest"]
                        }, null, 2),
                        category: 'technical'
                    },
                    {
                        name: 'Customer Reviews.csv',
                        type: 'CSV',
                        content: `Customer,Rating,Comments\nSarah Johnson,5,"The loveseat is incredibly comfortable and looks even better in person!"\nMichael Brown,4,"Good quality, but the assembly instructions could be clearer"\nEmily Davis,5,"Perfect size for our apartment and the upholstery is beautiful"`,
                        category: 'feedback'
                    }
                ];
                
                sampleFiles.forEach((file, index) => {
                    setTimeout(() => {
                        const blob = new Blob([file.content], { type: 'text/plain' });
                        const fakeFile = new File([blob], file.name, { 
                            type: 'text/plain',
                            lastModified: Date.now()
                        });
                        
                        Object.defineProperty(fakeFile, 'size', { value: file.content.length });
                        
                        app.addPlaceholderCard(fakeFile);
                        
                        setTimeout(() => {
                            const processedFile = {
                                id: Date.now() + Math.floor(Math.random() * 1000),
                                name: file.name,
                                type: file.type,
                                date: new Date().toLocaleDateString(),
                                size: fileProcessor.formatFileSize(file.content.length),
                                content: file.content,
                                status: 'ready',
                                category: file.category
                            };
                            
                            fileProcessor.processedFiles.push(processedFile);
                            app.updateFileCard(processedFile);
                            app.updateAnalysis(processedFile);
                        }, 1500);
                    }, index * 800);
                });
            }, 1000);
        });
    </script>
</body>
</html>
