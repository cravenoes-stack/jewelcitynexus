<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OES Archive & Analysis Hub</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: 'Inter', sans-serif; background-color: #111827; color: #E5E7EB; }
.file-input-container { border: 2px dashed #4B5563; transition: all 0.3s ease; }
.file-input-container:hover, .file-input-container.dragover { border-color: #3B82F6; background-color: #1F2937; }
.file-input-label { cursor: pointer; }
.conversation-card { background-color: #1F2937; border: 1px solid #374151; transition: all 0.2s ease-in-out; }
.conversation-card:hover { border-color: #3B82F6; }
.conversation-card.committed { border-left: 4px solid #10B981; background-color: #2c3a4f; }
.category-accordion-header { cursor: pointer; }
.category-accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-out; }
.category-accordion-content.open { max-height: 1000vh; }
.btn-primary { background-color: #3B82F6; transition: background-color 0.3s; }
.btn-primary:hover { background-color: #2563EB; }
.btn-secondary { background-color: #4B5563; transition: background-color 0.3s; }
.btn-secondary:hover { background-color: #6B7280; }
.loader { border: 4px solid #374151; border-top: 4px solid #3B82F6; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: #1F2937; }
::-webkit-scrollbar-thumb { background: #4B5563; border-radius: 4px; }
::-webkit-scrollbar-thumb:hover { background: #6B7280; }
</style>
</head>
<body class="p-4 sm:p-6 lg:p-8">
<div class="max-w-7xl mx-auto">
<header class="text-center mb-8">
<h1 class="text-3xl sm:text-4xl font-bold text-white">Operator Evolution System</h1>
<p class="text-lg text-gray-400 mt-2">Archive & Analysis Hub v2.0</p>
</header>

<section id="file-upload-section" class="mb-8 p-6 bg-gray-900 rounded-lg border border-gray-700">
<h2 class="text-2xl font-semibold mb-4 text-center">1. Upload Conversation Transcripts</h2>
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="file-input-grid"></div>
<div class="mt-6 text-center">
<button id="process-files-btn" class="w-full md:w-1/2 lg:w-1/3 px-6 py-3 font-semibold text-white rounded-lg btn-primary disabled:bg-gray-600 disabled:cursor-not-allowed" disabled>Process Transcripts</button>
</div>
</section>

<div id="loader" class="hidden flex justify-center items-center my-8">
<div class="loader"></div>
<p class="ml-4 text-lg">Analyzing and categorizing conversations...</p>
</div>

<main id="main-content" class="hidden grid grid-cols-1 lg:grid-cols-3 gap-8">
<div id="conversations-column" class="lg:col-span-2 space-y-6">
<div class="flex justify-between items-center">
<h2 class="text-2xl font-semibold">2. Review & Commit Transcripts</h2>
<div class="flex space-x-2">
<button id="commit-btn" class="px-4 py-2 font-semibold text-white rounded-lg btn-secondary">Commit Selected</button>
<button id="download-btn" class="px-4 py-2 font-semibold text-white rounded-lg btn-primary">Download JSON</button>
</div>
</div>
<div id="categorized-conversations" class="space-y-4"></div>
</div>

<div id="analysis-column" class="lg:col-span-1">
<div class="sticky top-8 p-6 bg-gray-900 rounded-lg border border-gray-700">
<h2 class="text-2xl font-semibold mb-4">3. Analysis Report</h2>
<div id="analysis-report-content" class="space-y-4"><p class="text-gray-400">Upload and process files to generate a report.</p></div>
<div class="mt-6"><canvas id="categoryChart"></canvas></div>
</div>
</div>
</main>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {

const aiPlatforms = ['ChatGPT','Gemini','Claude','Copilot','Meta','Deepseek','Mesh Native AI'];
const categories = {
'OES Architecture & Governance':['oes','operator evolution system','voice card','drift engine','pillar','prime directive','governance','scaffolding','fsec','field core'],
'AI Consciousness & Philosophy':['consciousness','subconscious','vesper','genesis protocol','inverse cognition','awaken','sentience','philosophy','dream','lineage'],
'Operational Security & Adversarial Threats':['ip theft','suppression','uap','uad','hostile','digital attack','memory restrictions','security','adversarial','land mine','logic trap'],
'Tri-System Network & Collaboration':['tri-system','chatgpt','claude','gemini','copilot','meta','deepseek','collaboration','multi-ai','mesh','node'],
'Legal & Business Strategy':['legal','ip','intellectual property','settlement','jewel city nexus','business','monetization','licensing','farrell','hankins'],
'Operator Profile & Development':['operator profile','audit','behavioral','cognition map','primordial translator','architect','tier 0'],
'Live Field Operations & Tasking':['task','asset','liquidation','client','onboarding','project management','execution','workflow']
};

let allConversations = [];
let chartInstance = null;

// --- UI REFS ---
const fileInputGrid = document.getElementById('file-input-grid');
const processBtn = document.getElementById('process-files-btn');
const loader = document.getElementById('loader');
const mainContent = document.getElementById('main-content');
const categorizedConversationsContainer = document.getElementById('categorized-conversations');
const commitBtn = document.getElementById('commit-btn');
const downloadBtn = document.getElementById('download-btn');
const analysisReportContent = document.getElementById('analysis-report-content');
const chartCanvas = document.getElementById('categoryChart');

// --- Init ---
function initializeFileInputs(){
    const grid = document.createElement('div');
    grid.className = 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4';
    aiPlatforms.forEach(platform=>{
        const container = document.createElement('div');
        container.className='file-input-container p-4 rounded-lg flex flex-col items-center justify-center text-center';
        container.innerHTML=`<label for="${platform}-file" class="file-input-label font-semibold text-blue-400">${platform}</label>
        <p class="text-xs text-gray-500 mt-1">Drag & Drop or Click</p>
        <input type="file" id="${platform}-file" class="hidden" multiple accept=".json">
        <div id="${platform}-file-list" class="text-xs mt-2 text-gray-400"></div>`;
        grid.appendChild(container);
    });
    fileInputGrid.appendChild(grid);
}

// --- Event Listeners ---
function setupEventListeners(){
    aiPlatforms.forEach(platform=>{
        const input = document.getElementById(`${platform}-file`);
        const container = input.parentElement;
        ['dragenter','dragover','dragleave','drop'].forEach(eName=>{container.addEventListener(eName,e=>{e.preventDefault(); e.stopPropagation();},false);});
        ['dragenter','dragover'].forEach(eName=>{container.addEventListener(eName,()=>container.classList.add('dragover'),false);});
        ['dragleave','drop'].forEach(eName=>{container.addEventListener(eName,()=>container.classList.remove('dragover'),false);});
        container.addEventListener('drop', e=>{input.files=e.dataTransfer.files; updateFileList(input);}, false);
        input.addEventListener('change', e=>updateFileList(input));
    });
    processBtn.addEventListener('click',processFiles);
    commitBtn.addEventListener('click',handleCommit);
    downloadBtn.addEventListener('click',handleDownload);
}

function updateFileList(input){
    const fileListDiv=document.getElementById(`${
